<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Processing Your Adventure</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>

<div class="container mt-4">
    <h3>ðŸ”„ Processing Your Multi-Day Journey...</h3>
    <p>We are enriching your route with elevation data, slope calculations, and difficulty classification.</p>
    
    <pre id="log-output">Waiting for logs...</pre>

    <script>
        const eventSource = new EventSource("/logs");

        eventSource.onmessage = function (event) {
            const logOutput = document.getElementById("log-output");
            logOutput.textContent += event.data + "\n";
            logOutput.scrollTop = logOutput.scrollHeight;
        };

        function checkProcessingStatus() {
            fetch(`/check-status/{{ session_id }}`)
                .then(response => response.json())
                .then(data => {
                    if (data.done) {
                        setTimeout(() => {
                            window.location.href = "/adventure";  // âœ… Redirect when processing is done
                        }, 2000);
                    }
                })
                .catch(error => console.error("Error checking processing status:", error));
        }

        setInterval(checkProcessingStatus, 2000);
    </script>

</div>
</body>
</html>
